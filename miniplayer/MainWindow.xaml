<Window x:Class="miniplayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ctrl="clr-namespace:miniplayer.controls"
        xmlns:cvt="clr-namespace:miniplayer.converters"
        xmlns:local="clr-namespace:miniplayer"        
        mc:Ignorable="d"
        SizeToContent="Height"
        WindowStyle="None"
        ResizeMode="NoResize"
        Title="MainWindow" Height="80" Width="400"
        MinWidth="250"
        MouseDown="Window_MouseDown">
    <Window.Resources>
        <cvt:TextBoxsToMaxSizeMultiConverter Padding="8" x:Key="TextBoxsToMaxSizeMultiConverter"/>
        <cvt:BoolToGeometeryConverter x:Key="PlayPauseConverter" 
                                      TrueValue="{StaticResource geo_pause_circle_filled}" 
                                      FalseValue="{StaticResource geo_play_circle_filled}"/>

        <cvt:BoolToGeometeryConverter x:Key="ShuffleConverter" 
                                      TrueValue="{StaticResource geo_shuffle_on}" 
                                      FalseValue="{StaticResource geo_shuffle}"/>

        <cvt:BoolToGeometeryConverter x:Key="FavoriteConverter" 
                                      TrueValue="{StaticResource geo_favorite}" 
                                      FalseValue="{StaticResource geo_favorite_border}"
                                      NullValue="{StaticResource geo_favorite_border}"/>

        <!--https://learn.microsoft.com/en-us/answers/questions/652068/mouse-resizing-cursor-changes-to-normal-in-wpf.html-->
        <Style x:Key="ResizeGripStyle" TargetType="Rectangle">
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Fill" Value="Transparent" />
            <Setter Property="Width" Value="4" />
            <Setter Property="Cursor" Value="SizeWE" />
            <EventSetter Event="MouseLeftButtonDown" Handler="Resize_Init"/>
            <EventSetter Event="MouseLeftButtonUp" Handler="Resize_End"/>
            <EventSetter Event="MouseMove" Handler="Resizing_Window"/>
        </Style>

        <Style x:Key="buttonStyle" TargetType="ctrl:PathButton">
            <Setter Property="PathFill" Value="Black"/>
            <Setter Property="PathStroke" Value="Transparent"/>
            <Setter Property="PathStrokeThickness" Value="0"/>
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Padding" Value="-2"/>
            <Setter Property="Margin" Value="1,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>

        <Rectangle Grid.Column="0" x:Name="_leftSizeGrip" Style="{StaticResource ResizeGripStyle}" />
        
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0" Margin="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="50" Width="*">
                            <ColumnDefinition.MaxWidth>
                                <MultiBinding Converter="{StaticResource TextBoxsToMaxSizeMultiConverter}">
                                    <MultiBinding.Bindings>
                                        <Binding ElementName="_title_text"/>
                                        <Binding ElementName="_artist_text"/>
                                        <Binding Path="Text" ElementName="_title_text"/>
                                        <Binding Path="Text" ElementName="_artist_text"/>
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </ColumnDefinition.MaxWidth>
                        </ColumnDefinition>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel x:Name="_title_artist_text" HorizontalAlignment="Left">
                        <TextBlock x:Name="_title_text" FontWeight="DemiBold" TextTrimming="CharacterEllipsis" Text="{Binding Title}"/>
                        <TextBlock x:Name="_artist_text" Grid.Row="1" Text="{Binding Artist}"/>
                    </StackPanel>

                    <ctrl:PathButton 
                        Grid.Column="1" 
                        HorizontalAlignment="Left"
                        Margin="4,0,8,0" Height="30" Width="30"
                        Background="Transparent"
                        BorderThickness="0"
                        PathData="{Binding IsFavorite, Converter={StaticResource FavoriteConverter}}" 
                        PathFill="LimeGreen"/>
                </Grid>

                <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Center">
                    <StackPanel.Resources>
                        <Style TargetType="ctrl:PathButton" BasedOn="{StaticResource buttonStyle}"/>
                    </StackPanel.Resources>
                    <ctrl:PathButton PathData="{Binding IsShuffleOn, Converter={StaticResource ShuffleConverter}}"/>
                    <ctrl:PathButton PathData="{StaticResource geo_skip_previous}"/>
                    <ctrl:PathButton x:Name="_play_pause_btn" PathData="{Binding IsPlaying, Converter={StaticResource PlayPauseConverter}}" Width="30" Height="30"/>
                    <ctrl:PathButton PathData="{StaticResource geo_skip_next}"/>
                    <ctrl:PathButton PathData="{StaticResource geo_repeat}"/>
                </StackPanel>

                <ctrl:PathButton x:Name="_closeBtn" 
                                 Grid.Column="3" 
                                 PathData="{StaticResource geo_close}" 
                                 Style="{StaticResource buttonStyle}"
                                 Width="10"
                                 Height="10" 
                                 Margin="4,2,0,0"
                                 VerticalAlignment="Top"
                                 HorizontalAlignment="Left"
                                 Click="_closeBtn_Click"/>
            </Grid>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <ProgressBar Grid.Column="1" Value="{Binding Position}" Minimum="0" Maximum="{Binding Duration}"/>
            </Grid>
        </Grid>

        <Rectangle Grid.Column="2" x:Name="_rightSizeGrip" Style="{StaticResource ResizeGripStyle}" />
    </Grid>
</Window>
