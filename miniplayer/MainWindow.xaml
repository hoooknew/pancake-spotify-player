<Window x:Class="miniplayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ctrl="clr-namespace:miniplayer.controls"
        xmlns:cvt="clr-namespace:miniplayer.converters"
        xmlns:mdl="clr-namespace:miniplayer.models"
        xmlns:local="clr-namespace:miniplayer"        
        mc:Ignorable="d"
        SizeToContent="Height"
        WindowStyle="None"
        ResizeMode="NoResize"
        Title="MainWindow" Height="80" Width="400"
        MinWidth="250"
        
        MouseDown="Window_MouseDown">
    <Window.Resources>
        <cvt:TextBoxsToMaxSizeMultiConverter Padding="8" x:Key="TextBoxsToMaxSizeMultiConverter"/>
        <cvt:BoolToGeometeryConverter x:Key="PlayPauseConverter" 
                                      TrueValue="{StaticResource geo_pause_circle_filled}" 
                                      FalseValue="{StaticResource geo_play_circle_filled}"/>

        <cvt:BoolToGeometeryConverter x:Key="ShuffleConverter" 
                                      TrueValue="{StaticResource geo_shuffle_on}" 
                                      FalseValue="{StaticResource geo_shuffle}"/>

        <cvt:BoolToGeometeryConverter x:Key="FavoriteConverter" 
                                      TrueValue="{StaticResource geo_favorite}" 
                                      FalseValue="{StaticResource geo_favorite_border}"
                                      NullValue="{StaticResource geo_favorite_border}"/>

        <cvt:RepeatConverter x:Key="repeatConverter" 
                             Off="{StaticResource geo_repeat}"
                             Track="{StaticResource geo_repeat_one_on}"
                             Context="{StaticResource geo_repeat_on}"/>

        <cvt:MStoStringConverter x:Key="MStoStringConverter" HoursFormat="h\:mm\:ss" MinutesFormat="m\:ss"/>

        <cvt:BoolToVisibilityConverter x:Key="uiConverter" TrueVisibility="Hidden" FalseVisibility="Visible"/>
        <cvt:BoolToVisibilityConverter x:Key="signinConverter" TrueVisibility="Visible" FalseVisibility="Collapsed"/>


        <!--https://learn.microsoft.com/en-us/answers/questions/652068/mouse-resizing-cursor-changes-to-normal-in-wpf.html-->
        <Style x:Key="ResizeGripStyle" TargetType="Rectangle">
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Fill" Value="Transparent" />
            <Setter Property="Width" Value="4" />
            <Setter Property="Cursor" Value="SizeWE" />
            <EventSetter Event="MouseLeftButtonDown" Handler="Resize_Init"/>
            <EventSetter Event="MouseLeftButtonUp" Handler="Resize_End"/>
            <EventSetter Event="MouseMove" Handler="Resizing_Window"/>
        </Style>

        <Style x:Key="buttonStyle" TargetType="ctrl:PathButton">
            <Setter Property="PathFill" Value="Black"/>
            <Setter Property="PathStroke" Value="Transparent"/>
            <Setter Property="PathStrokeThickness" Value="0"/>
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Padding" Value="-2"/>
            <Setter Property="Margin" Value="1,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
    </Window.Resources>
    <Border BorderThickness="1" BorderBrush="SlateGray">
        <Grid>

            <Rectangle x:Name="_leftSizeGrip" Style="{StaticResource ResizeGripStyle}"  HorizontalAlignment="Left"/>
            <Rectangle x:Name="_rightSizeGrip" Style="{StaticResource ResizeGripStyle}" HorizontalAlignment="Right"/>

            <Grid x:Name="signin_grid" Grid.Column="1" Visibility="{Binding NeedToken, Converter={StaticResource signinConverter}}" Background="#DDDDDD">
                <Button Padding="8,4" Click="_signin_Click" HorizontalAlignment="Center" VerticalAlignment="Center" Background="White">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" Margin="0,0,4,0">Sign In to</TextBlock>
                        <Viewbox Height="25">
                            <Path Fill="{StaticResource spotify_green}" Data="{StaticResource geo_spotify_logo}"/>
                        </Viewbox>
                    </StackPanel>
                </Button>
            </Grid>

            <Grid x:Name="ui_grid" Grid.Column="1" 
              Visibility="{Binding NeedToken, Converter={StaticResource uiConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Margin="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition MinWidth="50" Width="*">
                                <ColumnDefinition.MaxWidth>
                                    <MultiBinding Converter="{StaticResource TextBoxsToMaxSizeMultiConverter}">
                                        <MultiBinding.Bindings>
                                            <Binding ElementName="_title_text"/>
                                            <Binding ElementName="_artist_text"/>
                                            <Binding Path="Text" ElementName="_title_text"/>
                                            <Binding Path="Text" ElementName="_artist_text"/>
                                        </MultiBinding.Bindings>
                                    </MultiBinding>
                                </ColumnDefinition.MaxWidth>
                            </ColumnDefinition>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel x:Name="_title_artist_text" HorizontalAlignment="Left">
                            <TextBlock x:Name="_title_text" FontWeight="DemiBold" TextTrimming="CharacterEllipsis" Text="{Binding Title}"/>
                            <TextBlock x:Name="_artist_text" Grid.Row="1" Foreground="SlateGray" FontWeight="Bold" FontSize="10" Text="{Binding Artist}"/>
                        </StackPanel>

                        <ctrl:PathButton 
                            Grid.Column="1" 
                            HorizontalAlignment="Left"
                            Margin="4,0,8,0" Height="30" Width="30"
                            Background="Transparent"
                            BorderThickness="0"
                            PathData="{Binding IsFavorite, Converter={StaticResource FavoriteConverter}}" 
                            PathFill="{StaticResource spotify_green}"/>
                    </Grid>

                    <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Center" Margin="0,0,18,0">
                        <StackPanel.Resources>
                            <Style TargetType="ctrl:PathButton" BasedOn="{StaticResource buttonStyle}"/>
                        </StackPanel.Resources>
                        <ctrl:PathButton PathData="{Binding IsShuffleOn, Converter={StaticResource ShuffleConverter}}"/>
                        <ctrl:PathButton PathData="{StaticResource geo_skip_previous}"/>
                        <ctrl:PathButton x:Name="_play_pause_btn" PathData="{Binding IsPlaying, Converter={StaticResource PlayPauseConverter}}" Width="30" Height="30"/>
                        <ctrl:PathButton PathData="{StaticResource geo_skip_next}"/>
                        <ctrl:PathButton PathData="{Binding RepeatState, Converter={StaticResource repeatConverter}}"/>
                    </StackPanel>

                </Grid>
                <Grid Grid.Row="1" Margin="2,0">
                    <Grid.Resources>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontSize" Value="11"/>
                            <Setter Property="Margin" Value="0,0,0,2"/>
                            <Setter Property="Foreground" Value="SlateGray"/>
                        </Style>
                    </Grid.Resources>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{Binding Position, Converter={StaticResource MStoStringConverter}}"/>
                    <ProgressBar Grid.Column="1" Height="4" Margin="2,0" BorderThickness="0" Foreground="{StaticResource spotify_green}" Background="LightGray" Value="{Binding Position}" Minimum="0" Maximum="{Binding Duration}" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Duration, Converter={StaticResource MStoStringConverter}}" Grid.Column="2"/>
                </Grid>
            </Grid>

            <ctrl:PathButton x:Name="_closeBtn" 
                                 Grid.ColumnSpan="3" 
                                 PathData="{StaticResource geo_close}" 
                                 Style="{StaticResource buttonStyle}"
                                 Width="10"
                                 Height="10" 
                                 Margin="0,4,4,0"
                                 VerticalAlignment="Top"
                                 HorizontalAlignment="Right"
                                 Click="_closeBtn_Click"/>
        </Grid>
    </Border>
</Window>
